<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Мем-баттл</title>
  <link rel="stylesheet" href="./style.css"/>
</head>
<body>
  <div class="bg"></div>

  <div class="wrap">
    <header class="header">
      <h1>Мем-баттл</h1>
      <p class="sub">Одна ссылка — и сервер, и фронт. Ведущий на ПК, игроки на телефонах.</p>
    </header>

    <main class="card">
      <section id="screen-mode" class="screen">
        <h2>Выбери режим</h2>
        <div class="btns">
          <button id="btn-mode-host" class="primary">Я ведущий (экран для всех)</button>
          <button id="btn-mode-player" class="secondary">Я игрок (телефон)</button>
        </div>
        <p class="hint">Диагностика: кнопка <b>DEBUG</b> внизу справа или <code>?debug=1</code> в URL.</p>
      </section>

      <section id="screen-host" class="screen hidden">
        <div class="row">
          <h2>Ведущий</h2>
          <div class="pill" id="host-conn">offline</div>
        </div>

        <div class="panel">
          <button id="host-create-room" class="primary">Создать комнату</button>
          <div class="roomline">
            <div>Код: <b id="host-room-code">—</b></div>
            <button id="host-copy-link" class="ghost">Скопировать ссылку</button>
          </div>
          <div class="muted" id="host-room-link"></div>
        </div>

          <div class="qrline">
            <div class="qrbox">
              <img id="host-qr-img" alt="QR" class="qrimg" />
              <div class="muted qrhint">Сканируй, чтобы зайти: <span id="host-room-code-mini">—</span></div>
            </div>
            <div class="qrbtns">
              <button id="host-qr-full" class="secondary" disabled>QR на весь экран</button>
            </div>
          </div>


        
          



        <div class="grid2">
          <div class="panel">
            <h3>Настройки игры</h3>
            <label>Раундов:
              <input id="host-total-rounds" type="number" min="1" max="20" value="5"/>
            </label>
            <label>Задания (по одному на строку):
              <textarea id="host-tasks" rows="6" placeholder="Мем про...\nМем когда...\n..."></textarea>
            </label>
            <div class="btns">
              <button id="host-start-game" class="primary">Начать игру</button>
              <button id="host-next-round" class="secondary" disabled>Следующий раунд</button>
              <button id="host-start-vote" class="secondary" disabled>Начать голосование</button>
              <button id="host-end-game" class="danger" disabled>Завершить игру</button>
              <button id="host-new-game" class="secondary hidden">Новая игра</button>
            </div>
            <div class="muted" id="host-round-info">Раунд: —</div>
          </div>

          <div class="panel">
            <h3>Игроки</h3>
            <div id="host-players" class="list"></div>
          </div>
        </div>

        <div class="panel">
          <h3>Мемы раунда</h3>
          <div id="host-memes" class="memes"></div>
          <div class="muted" id="host-phase">Фаза: —</div>
        </div>

        <div class="panel">
          <h3>Результаты</h3>
          <div id="host-results" class="results"></div>
        </div>
      </section>

      <section id="screen-player" class="screen hidden">
        <div class="row">
          <h2>Игрок</h2>
          <div class="pill" id="player-conn">offline</div>
        </div>

        <div class="panel">
          <label>Код комнаты:
            <input id="player-room" placeholder="ABCD" autocomplete="off"/>
          </label>
          <label>Ник:
            <input id="player-nick" placeholder="Твой ник" autocomplete="off"/>
          </label>
          <button id="player-join" class="primary">Войти</button>
          <div class="muted" id="player-join-status"></div>
        </div>

        <div class="panel">
          <h3>Задание</h3>
          <div id="player-task" class="task">—</div>
        </div>

        <div class="panel">
          <h3>Отправь мем</h3>
          <label>Ссылка на картинку/GIF:
            <input id="player-meme-url" placeholder="https://..." autocomplete="off"/>
          </label>

          <label>Файл (картинка или GIF):
            <input id="player-meme-file" type="file" accept="image/*,image/gif"/>
          </label>
          <div class="muted">Если выбран файл — ссылка будет игнорироваться. Лимит ~8MB.</div>

          <label>Подпись (необязательно):
            <input id="player-meme-caption" placeholder="..." autocomplete="off"/>
          </label>
          <div class="btns">
            <button id="player-send-meme" class="primary">Отправить</button>
            <div id="player-sent" class="sent hidden">✅ Мем отправлен</div>
          </div>
        </div>

        <div class="panel">
          <h3>Голосование</h3>
          <div id="player-vote" class="memes"></div>
          <div id="player-voted" class="sent hidden">✅ Голос учтён</div>
        </div>

        <div class="panel">
          <h3>Финал</h3>
          <div id="player-final" class="results"></div>
        </div>
      </section>
    </main>
  </div>

  
  <button id="settings-toggle" class="settings-btn hidden">Настройки</button>
  <div id="settings-panel" class="settings hidden">
    <div class="settings-head">
      <b>Настройки</b>
      <button id="settings-close" class="ghost">×</button>
    </div>
    <div class="settings-body">
      <div class="panel admin" id="admin-panel">
            <div class="row">
              <h3>Admin mode</h3>
              <label class="switch">
                <input id="admin-enabled" type="checkbox"/>
                <span class="sw"></span>
              </label>
            </div>
            <div class="muted">Калибровка карточки плеера действует только на этом устройстве.</div>

            <div class="admin-grid">
              <div>
                <label>Ширина карточки (px):
                  <input id="cal-card-w" type="range" min="240" max="900" step="10" value="520"/>
                  <span class="rangev" id="cal-card-wv">520</span>
                </label>

                <label>Высота карточки (px):
                  <input id="cal-card-h" type="range" min="220" max="900" step="10" value="520"/>
                  <span class="rangev" id="cal-card-hv">520</span>
                </label>


                <label>Масштаб плеера (zoom):
                  <div class="rangeRow">
                    <button id="cal-zoom-minus" class="miniBtn ghost" type="button">−</button>
                    <input id="cal-zoom" type="range" min="0.10" max="2.0" step="0.01" value="1"/>
                    <button id="cal-zoom-plus" class="miniBtn ghost" type="button">+</button>
                    <span class="rangev" id="cal-zoomv">1.00</span>
                  </div>
                </label>

                <label>Привязка (Y):
                  <select id="cal-anchor-y">
                    <option value="top">верх</option>
                    <option value="center">центр</option>
                    <option value="bottom">низ</option>
                  </select>
                </label>

                
                <label>Рамки по краям (px):
                  <input id="cal-crop-x" type="range" min="-600" max="600" step="2" value="0"/>
                  <span class="rangev" id="cal-crop-xv">0</span>
                </label>
<label>Обрезка снизу (px):
                  <input id="cal-crop-b" type="range" min="0" max="260" step="2" value="60"/>
                  <span class="rangev" id="cal-crop-bv">60</span>
                </label>

                <div class="btns">
                  <button id="cal-save" class="primary" type="button">Сохранить</button>
                  <button id="cal-reset" class="ghost" type="button">Сброс</button>
                </div>
                <div class="muted" id="cal-save-status" style="margin-top:8px"></div>
              </div>

              <div>
                <div class="muted" style="margin-bottom:6px">Пресеты</div>
                <div class="btns">
                  <button id="cal-preset-desktop" class="secondary">ПК / большой экран</button>
                  <button id="cal-preset-mobile" class="secondary">Мобилка (вертикаль)</button>
                </div>
                <div class="muted" style="margin-top:10px">Совет: выставь высоту так, чтобы в карточке осталось только видео, а низ TikTok ушёл за край через «Обрезка снизу».</div>

                <div class="muted" style="margin-top:14px; margin-bottom:6px">Калибровочное видео (TikTok)</div>
                <div id="cal-preview" class="cal-preview"></div>
                <div class="btns" style="margin-top:10px">
                  <button id="cal-open-video" class="ghost" type="button">Открыть калибровочное видео</button>
                </div>
              </div>
            </div>
          </div>
    </div>
  </div>

<button id="debug-toggle" class="debug-btn">DEBUG</button>
  <div id="debug-panel" class="debug hidden">
    <div class="debug-head">
      <b>DEBUG</b>
      <div class="debug-actions">
        <button id="debug-copy" class="ghost">Copy</button>
        <button id="debug-clear" class="ghost">Clear</button>
      </div>
      <button id="debug-close" class="ghost">×</button>
    </div>
    <div id="debug-body" class="debug-body"></div>
  </div>


  <div id="qr-overlay" class="overlay hidden">
    <div class="overlay-card">
      <div class="row">
        <h3>QR для входа</h3>
        <button id="qr-close" class="ghost">×</button>
      </div>
      <img id="qr-overlay-img" class="qrimg big" alt="QR"/>
      <div class="muted" id="qr-overlay-link">—</div>
      <div class="btns" style="margin-top:10px">
        <button id="qr-copy" class="secondary">Скопировать ссылку</button>
      </div>
    </div>
  </div>


  <script src="/socket.io/socket.io.js"></script>
  <script src="./script.js"></script>
</body>
</html>
